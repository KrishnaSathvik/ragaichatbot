<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAG Chatbot</title>
    <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; margin: 0; background: #0b0f14; color: #e6edf3; }
    .wrap { max-width: 880px; margin: 48px auto; padding: 0 16px; }
    .card { background: #0f1621; border: 1px solid #1d2734; border-radius: 16px; padding: 20px; box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .row { display: flex; gap: 10px; }
    textarea { flex: 1; background: #0b131d; color: #e6edf3; border: 1px solid #1f2a38; border-radius: 12px; padding: 12px; min-height: 90px; resize: vertical; }
    button { background: #2563eb; border: none; color: white; padding: 12px 16px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .answer { white-space: pre-wrap; line-height: 1.6; margin-top: 16px; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .chip { background: #0b131d; border: 1px solid #1f2a38; padding: 6px 10px; border-radius: 9999px; color: #93c5fd; text-decoration: none; font-size: 12px; }
    .mode-selector { display: flex; gap: 8px; margin-bottom: 16px; }
    .mode-btn { background: #1f2a38; border: 1px solid #1f2a38; color: #93c5fd; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .mode-btn.active { background: #2563eb; border-color: #2563eb; color: white; }
    </style>
</head>
<body>
  <div class="wrap">
    <h1>RAG Chatbot</h1>
    <div class="card">
      <div class="mode-selector">
        <button class="mode-btn active" data-mode="default">Default</button>
        <button class="mode-btn" data-mode="interview">Interview</button>
        <button class="mode-btn" data-mode="sql">SQL</button>
        <button class="mode-btn" data-mode="eli5">ELI5</button>
      </div>
      <div class="row">
        <textarea id="q" placeholder="Ask about Databricks, ADF, Snowflake, RAG, MLOps…"></textarea>
        <button id="send">Ask</button>
      </div>
      <div id="out" class="answer">Ask something to begin.</div>
      <div id="sources" class="chips"></div>
        </div>
    </div>

    <script>
    const out = document.getElementById('out');
    const chips = document.getElementById('sources');
    const btn = document.getElementById('send');
    const ta = document.getElementById('q');
    let currentMode = 'default';

    // Mode selector
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;
      });
    });

    async function ask(query){
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: query, mode: currentMode })
      });
      const data = await res.json();
      if(!res.ok || data.error){ throw new Error(data.error || 'Request failed'); }
      return data;
    }

    function render(data){
      // Render plain text (no accidental markdown bolding)
      out.textContent = data.answer || '';
      chips.innerHTML = '';
      (data.sources||[]).forEach(s => {
        const a = document.createElement('a');
        a.href = s.path || '#';
        a.target = '_blank';
        a.rel = 'noopener';
        a.className = 'chip';
        a.textContent = s.title || 'Source';
        chips.appendChild(a);
      });
    }

    btn.addEventListener('click', async () => {
      const q = ta.value.trim();
      if(!q) return;
      btn.disabled = true; out.textContent = 'Thinking…'; chips.innerHTML = '';
      try { render(await ask(q)); } catch(e){ out.textContent = 'Error: ' + e.message; }
      finally { btn.disabled = false; }
    });

    ta.addEventListener('keydown', (e)=>{
      if((e.metaKey || e.ctrlKey) && e.key === 'Enter'){ btn.click(); }
    });
    </script>
</body>
</html>